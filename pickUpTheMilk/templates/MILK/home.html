{% extends 'MILK/base.html' %}
{% load staticfiles %}

{% block title_block %} Home {% endblock %}

    {% block body_block %}
    <h1> <img src="{%static "images/milklogo.png" %}" alt= "Milk Carton Logo" height ="100"/>
      Passive Aggressive Cost-Sharing App. v. 0.4.5
    </h1>

    {% if user.is_authenticated %}
        <h2> Welcome back, {{ user.username }}! </h2>
    {% else %}
        <h2> Welcome! </h2>
    {% endif %}


    <section>
    {% if user.is_authenticated %}
      </br>

      <div>
          <h6>Communal shopping list: (Need to handle a single group's empty list more gracefully! Scrollable lists not working anymore :(</h6>
      </div>

        {% if user.groups.all.0 %}

            <div class="scroll-list">
                {% if Items %}
                {% for item in Items %}
                {% if user.groups.all.0 == item.groupBuying %}
                <li>
                    {{ item.itemName }}
                </li>
                {% endif %}
                {% endfor %}
                {% else %} Your shopping list is empty. {% endif %}
                </br>
            </div>

            <a href="{% url 'needsbought' %}">Running out of something? Mark it as needing bought here!</a>
            <!--<h6> Items you need to <strong>pick up</strong> (just like the name of the app!)</h6>-->

            <!--<div class=scroll-list>-->
                <!--{% if Items %}-->
                    <!--{% for item in Items %}-->
                        <!--{% if user.groups.all.0 == item.groupBuying %}-->
                            <!--{% if item.itemNeedsBought %}-->
                                <!--<li>-->
                                    <!--{{ item.itemName }}-->
                                <!--</li>-->
                            <!--{% endif %}-->
                         <!--{% endif %}-->
                    <!--{% endfor %}-->
                <!--{% endif %}-->
            <!--</div>-->

    </section>

         <!--Sets modal button type-->
    <button type="button" class="btn btn-info btn-sm listButton" data-toggle="modal" data-target="#myModal" onclick="myAlert()">Record Purchase</button>
    <scipt>
        function myAlert(){
            e.preventDefault();});</scipt>
    <div>
        <!-- Modal -->
        <div id="myModal" class="modal fade" role="dialog">
            <div class="modal-dialog">

                <!-- Modal content-->
                <div class="modal-content">
                    <div class="modal-header">
                        <button type="button" class="close" data-dismiss="modal">&times;</button>
                        <h4 class="modal-title">Enter Purchase Details</h4>
                    </div>
                    <div class="modal-body">
                        <div>
                            <form id="RecordPurchase" method="post" action="." }>

                                {% csrf_token %}

                                {% for hidden in form.hidden_fields %}
                                {{ hidden }}
                                {% endfor %}

                                {% for field in form.visible_fields %}
                                {{ field.errors }}
                                {{ field.help_text }}
                                {{ field }}
                                {% endfor %}


                              <input type="submit" , name="submit" , value="Record a purchase">

        </div>

                        </div>
                    </div>
                </div>
            </div>
        </div>




        <!--Should this only appear if there are items in the to buy list
             should we be able to add and record the purchase of items on the same page
             For the case of someone realising then need something when they are in the shop-->
        <!--<a href="{% url 'recordpurchase' %}">Record a purchase.</a></br>-->
        <!--Link to the page to resolve kitty/settle up balance-->
        <a href="{% url 'settle-up' user.groups.all.0 %}">Settle up all balances.</a>
        {% endif %}
    {% else %}
        <!-- User not authenticated -->
        <!-- Line below demonstrates how we would include another template -->
        <!-- {% include 'MILK/notloggedin.html' %} -->

        Use our website and we definitely won't harvest your shopping data and use it to target ads at you.

      <aside>
          <p>
              <a href="{% url 'auth_login' %}?/next=/">Login</a> or
              <a href="{% url 'registration_register' %}">Register</a>
              <p>
      </aside>
    {% endif %}


</section>

<!--Include the Google Maps widget-->
<section>
    Search for your nearest store:
    {% include 'MILK/maps.html' %}
</section>

{% endblock %}

{% block side_block %}

    <h2> Hello Friend! </h2>

    {% if user.is_authenticated %}
    <!--{% include 'MILK/profilesidebar.html' %}-->
        <p> This is a side bar where the user profile (or maybe lists of some kind?) would be displayed. Example of list:</p></br>

        Items to buy:</br>
        <div class=scroll-list>
                {% if Items %}
                    {% for item in Items %}
                        {% if user.groups.all.0 == item.groupBuying %}
                            {% if item.itemNeedsBought %}
                                <li>
                                    {{ item.itemName }}
                                </li>
                            {% endif %}
                        {% endif %}
                    {% endfor %}
                {% endif %}
        </div>
    {% else %}
        SIGN UP</br>
        (superliminal messaging)
    {% endif %}

{% endblock %}

</body>
</html>
